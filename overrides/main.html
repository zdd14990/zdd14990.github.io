{% extends "base.html" %}

{% block copyright %}
  <div class="md-copyright">
    {% if config.copyright %}
      <div class="md-copyright__highlight">
        {{ config.copyright }}
      </div>
    {% endif %}

    <div style="margin-top: 10px; font-size: 0.85rem; color: var(--md-footer-fg-color--lighter);">
      <span id="busuanzi_container_site_pv" style="display:none">
        本站总访问量 <span id="busuanzi_value_site_pv" style="font-weight: bold; color: #e67e96;"></span> 次
      </span>
      &nbsp; | &nbsp;
      <span id="busuanzi_container_site_uv" style="display:none">
        访客数 <span id="busuanzi_value_site_uv" style="font-weight: bold; color: #e67e96;"></span> 人
      </span>
    </div>

    {{ super() }}

    <br>
    <span style="font-size: 0.8rem;">
    Made with <span style="color: #e74c3c; display: inline-block; animation: heartbeat 1.5s ease-in-out infinite;">❤</span> by zdd
    </span>

    <style>
    @keyframes heartbeat {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
    }
    </style>
  </div>
{% endblock %}


{% block scripts %}
  {{ super() }}

  <style>
    body[data-md-color-scheme="default"]::before {
        background-image: url('{{ base_url }}/assets/site_bg_light.jpg');
    }
    body[data-md-color-scheme="slate"]::after {
        background-image: url('{{ base_url }}/assets/site_bg_dark.jpg');
    }
  </style>

  <script>
  (function() {
      var audioPath = "{{ base_url }}/assets/bgm.mp3";

      if (!window.myGlobalAudio) {
          window.myGlobalAudio = new Audio(audioPath);
          window.myGlobalAudio.loop = true; 
          window.myGlobalAudio.volume = 0.5; 
      }

      var oldBtn = document.getElementById('my-simple-player');
      if (oldBtn) oldBtn.remove();

      var playerContainer = document.createElement('div');
      playerContainer.id = 'my-simple-player';
      playerContainer.className = 'simple-player-floating';
      playerContainer.innerHTML = `
          <div class="player-icon" id="player-btn" title="点击播放/暂停">
              <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M9 18V5l12-2v13"></path>
                  <circle cx="6" cy="18" r="3"></circle>
                  <circle cx="18" cy="16" r="3"></circle>
              </svg>
          </div>
      `;
      document.body.appendChild(playerContainer);

      var btnIcon = document.getElementById('player-btn');
      var audio = window.myGlobalAudio;

      audio.onerror = function() {
          console.error("BGM加载失败:", audioPath);
      };

      if (!audio.paused) {
          btnIcon.classList.add('playing');
      }

      btnIcon.onclick = function() {
          if (audio.paused) {
              var p = audio.play();
              if (p !== undefined) {
                  p.then(_ => btnIcon.classList.add('playing')).catch(e => console.error(e));
              }
          } else {
              audio.pause();
              btnIcon.classList.remove('playing');
          }
      };
  })();
  </script>

  <script>
    document$.subscribe(function() {
        var h1 = document.querySelector(".md-content__inner h1");
        var isHomePage = location.pathname === "/" || location.pathname.endsWith("index.html");
        
        if (h1 && !document.getElementById("page-pv-container") && !isHomePage) {
            var pvContainer = document.createElement("div");
            pvContainer.id = "page-pv-container";
            pvContainer.style.cssText = "color: var(--md-default-fg-color--light); font-size: 0.8rem; margin-top: -10px; margin-bottom: 20px;";
            pvContainer.innerHTML = `
                <span id="busuanzi_container_page_pv" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" style="vertical-align: sub; fill: currentColor; margin-right: 4px;">
                        <path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5Z"/>
                    </svg>
                    阅读量：<span id="busuanzi_value_page_pv" style="font-weight: bold;">--</span>
                </span>
            `;
            h1.parentNode.insertBefore(pvContainer, h1.nextSibling);
        }

        var oldScript = document.getElementById("busuanzi-script-tag");
        if (oldScript) { oldScript.remove(); }
        
        var sitePv = document.getElementById("busuanzi_container_site_pv");
        if (sitePv) sitePv.style.display = "none";

        var script = document.createElement("script");
        script.id = "busuanzi-script-tag";
        script.src = "//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js";
        script.async = true;
        document.body.appendChild(script);
    });
  </script>



<script>
    document$.subscribe(function() {
        var card = document.querySelector(".profile-card");
        if (!card) return;

        // 定义初始化函数
        function initTilt() {
            if (window.VanillaTilt) {
                if (card.vanillaTilt) card.vanillaTilt.destroy(); // 清理旧实例
                VanillaTilt.init(card, {
                    max: 8,             // 倾斜角度
                    
                    /* ✅ 修改这里：改大数值，回弹更慢更平滑 */
                    speed: 1000,        // 建议 1000 (1秒)
                    
                    glare: true,        // 开启反光
                    "max-glare": 0.2,   // 反光强度
                    scale: 1.05,        // 悬停放大
                    gyroscope: false,
                    perspective: 1000
                });
                return true;
            }
            return false;
        }

        // 尝试运行。如果失败（库还没加载完），开启定时器等待
        if (!initTilt()) {
            var checkTilt = setInterval(function() {
                if (initTilt()) {
                    clearInterval(checkTilt);
                }
            }, 100);
        }
    });
  </script>

{% endblock %}